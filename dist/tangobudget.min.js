/*! tangobudget 2018-09-01 */

function addMarkersAndAll(e,t){path=poly.getPath(),path.push(e);var o=new google.maps.Marker({position:e,label:labels[labelIndex++%labels.length],map:t,draggable:!0,animation:google.maps.Animation.DROP,title:"#"+path.getLength()});if(markers.push(o),poly.setMap(t),latitud.push(o.getPosition().lat()),longitud.push(o.getPosition().lng()),showCoordenadas(latitud,longitud),google.maps.event.addListener(o,"drag",function(e){if("B"==o.getLabel())path.pop(),path.push(e.latLng),path=poly.getPath(),latitud[1]=o.getPosition().lat(),longitud[1]=o.getPosition().lng();else{var t=path.removeAt(1);path.removeAt(0);path.setAt(1,t),path.setAt(0,e.latLng),path=poly.getPath(),latitud[0]=o.getPosition().lat(),longitud[0]=o.getPosition().lng()}if(showCoordenadas(latitud,longitud),2==markers.length){var a=new google.maps.ElevationService;camino[0]=path.getAt(0),camino[1]=path.getAt(1);var n=haversine(radius,latitud,longitud);displayPathElevation(camino,a,n)}}),o.addListener("click",toggleBounce),2==markers.length){var a=new google.maps.ElevationService;camino[0]=path.getAt(0),camino[1]=path.getAt(1);var n=haversine(radius,latitud,longitud);displayPathElevation(camino,a,n)}}function Fresnel(e,t,a){var n;n=22/e;var o=haversine(radius,latitud,longitud);tan_alpha=(t-a)/o,alpha=Math.atan(tan_alpha);var l=o/2,i=l/Math.cos(alpha),d=l/Math.cos(alpha);R1=Math.sqrt(n*i*d/(i+d));var r=.8*R1,s=.6*R1,g=altura[mitad_cantmuestras];x,h,x,h;return 0}function FSL(e,t,a,n){var o;o=22/n;var l=4*Math.PI*e/o;return 20*Math.log10(l)}function InputUser(){var e=document.getElementById("gananciatx").value,t=document.getElementById("gananciarx").value,a=document.getElementById("potenciatx").value,n=document.getElementById("frecuencia").value,o=document.getElementById("disponibilidad").value/100,l=document.getElementById("alturaantenatx").value,i=document.getElementById("alturaantenarx").value,d=haversine(radius,latitud,longitud),r=document.getElementById("perdidasconectores").value,s=FSL(d,l,i,n),g=MF(d,1,.25,n,o),u=e+t+a-r-s-0;console.log("La frecuencia ingresada es: "+n),console.log("perdidasFSL: "+s),console.log("Prx es: "+u),console.log("El margen de fading es: "+g),console.log("La disponibildad del canal es: "+o)}function LOS(e,t,a){var n=new google.visualization.DataTable;n.addColumn("string","Muestras"),n.addColumn("number","Elevacion");for(var o=0;o<t.length;o++)n.addRow(["",e[o]]),"undefined"==n.getValue(o,1)&&(a[o]=0,e[o]=0);var l,i;new google.visualization.LineChart(document.getElementById("elevation_chart2")).draw(n,{height:200,legend:"none",titleY:"Perfil de elevacion (m)"});var d=e.indexOf(n.getDistinctValues(1)[t.length-1]);if(0!=d&&d!=t.length-1){console.log("Prueba: "+n.getDistinctValues(1)[t.length-1]);var r=n.getDistinctValues(1)[t.length-1].toFixed(3);return r>e[t.length-1].toFixed(3)&&r>e[0].toFixed(3)?0:e[0].toFixed(3)<r<e[t.length-1].toFixed(3)?(l=(e[t.length-1].toFixed(3)-e[0].toFixed(3))/(t.length-1-0),(r-e[0].toFixed(3))/(d-0)<=l?1:0):e[t.length-1].toFixed(3)<r<e[0].toFixed(3)?(l=(e[t.length-1].toFixed(3)-e[0].toFixed(3))/(t.length-1-0))<=(r-e[0].toFixed(3))/(d-0)?1:0:1}if(0==d||d==t.length-1){if(0==(i=e.indexOf(n.getDistinctValues(1)[t.length-2]))||i==t.length-1){var s=n.getDistinctValues(1)[t.length-3].toFixed(1),g=e.indexOf(n.getDistinctValues(1)[t.length-3]);return s>e[t.length-1].toFixed(3)&&s>e[0].toFixed(3)?0:e[0].toFixed(3)<s<e[t.length-1].toFixed(3)?(l=(e[t.length-2].toFixed(3)-e[0].toFixed(3))/(t.length-1-0),(s-e[0].toFixed(3))/(g-0)<=l?1:0):e[t.length-1].toFixed(3)<s<e[0].toFixed(3)?(l=(e[t.length-1].toFixed(3)-e[0].toFixed(3))/(t.length-1-0))<=(s-e[0].toFixed(3))/(g-0)?1:0:1}return 1}var u=n.getDistinctValues(1)[t.length-2].toFixed(1);return u>e[t.length-1].toFixed(3)&&u>e[0].toFixed(3)?0:e[0].toFixed(3)<u<e[t.length-1].toFixed(3)?(l=(e[t.length-1].toFixed(3)-e[0].toFixed(3))/(t.length-1-0),(u-e[0].toFixed(3))/(i-0)<=l?1:0):e[t.length-1].toFixed(1)<u<e[0].toFixed(1)?(l=(e[t.length-1].toFixed(1)-e[0].toFixed(1))/(t.length-1-0))<=(u-e[0].toFixed(1))/(i-0)?1:0:1}function MF(e,t,a,n,o){return 30*Math.log10(e)+10*Math.log10(6*t*a*n)-10*Math.log10(1-o)-70}function ModifyHeight(){var e=document.getElementById("alturaobjeto").value,t=document.getElementById("distanciaobjeto").value,a=haversine(radius,latitud,longitud),n=100*a,o=Math.floor(n);if(chart=new google.visualization.ColumnChart(chartDiv),data=new google.visualization.DataTable,0<t<a){for(j=0;j<=o;j++)for(i=0;i<=t<i+10;i+=10)data.setValue(j,1,altura[j]+e),chart.draw(data,{height:200,legend:"none",titleX:"Cantidad de muestras",titleY:"Elevation (m)"});alert("Altura modificada correctamente.")}else alert("Distancia seleccionada excede el largo del camino.")}function Tilt(e,t,a){return toDegrees(Math.atan((t-a)/e))}function ClickInput(){geocodeLatLng(new google.maps.Geocoder,map)}function DistanceToBorders(e,t){lat[0]=e[t].lat(),lng[0]=e[t].lng(),lat[1]=e[255].lat(),lng[1]=e[255].lng();var a=haversine(radius,lat,lng);console.log("Distancia a RX"+a.toFixed(6)+" km"),lat[1]=e[0].lat(),lng[1]=e[0].lng();haversine(radius,lat,lng);console.log("Distancia a TX"+a.toFixed(6)+" km")}function dragElement(t){var a=0,n=0,o=0,l=0;function e(e){(e=e||window.event).preventDefault(),o=e.clientX,l=e.clientY,document.onmouseup=d,document.onmousemove=i}function i(e){(e=e||window.event).preventDefault(),a=o-e.clientX,n=l-e.clientY,o=e.clientX,l=e.clientY,t.style.top=t.offsetTop-n+"px",t.style.left=t.offsetLeft-a+"px"}function d(){document.onmouseup=null,document.onmousemove=null}document.getElementById(t.id+"Header")?document.getElementById(t.id+"Header").onmousedown=e:t.onmousedown=e}function displayPathElevation(e,t,a){var n=100*a,o=Math.floor(n);console.log("Cantidad de muestras por km: "+n),console.log("Redondeo de muestras: "+o),t.getElevationAlongPath({path:e,samples:o},plotElevation)}function plotElevation(e,t){var a=document.getElementById("elevation_chart");if("OK"===t){var n=new google.visualization.ColumnChart(a),o=new google.visualization.DataTable;o.addColumn("string","Sample"),o.addColumn("number","Elevation");for(var l=0;l<e.length;l++)o.addRow(["",e[l].elevation]),"undefined"==o.getValue(l,1)&&(coordenadas[l]=0,altura[l]=0),altura[l]=o.getValue(l,1),coordenadas[l]=e[l].location;mitad_cantmuestras=e.length/2,console.log("Altura de cada punto: "+altura[0]+", "+altura[1]+", "+altura[2]),console.log("Coordenadas de cada punto: ("+coordenadas[0].lat()+", "+coordenadas[0].lng()+") ("+coordenadas[1].lat()+", "+coordenadas[1].lng()+")"),console.log("Altura Pmax: "+o.getDistinctValues(1)[e.length-1]);var i=altura.indexOf(o.getDistinctValues(1)[e.length-1]);console.log("Posición de Pmax: "+i);var d=haversine(radius,latitud,longitud);n.draw(o,{height:200,legend:"none",titleX:"Cantidad de muestras",titleY:"Elevation (m)"});var r=LOS(altura,e,coordenadas);console.log("¿Hay LOS?: "),1==r?(console.log("Si!"),console.log("Tilt: "+Tilt(d,e[0].elevation,e[e.length-1].elevation))):0==r?console.log("No!"):console.log("Indefinido")}else a.innerHTML="Cannot show elevation: request failed because "+t}function showCoordenadas(e,t){for(var a=0;a<markers.length;a++)document.getElementById("transmisor").value=e[0]+", "+t[0],document.getElementById("receptor").value=e[1]+", "+t[1];if(0!==e[0]&&0!==e[1]){var n=haversine(radius,e,t);document.getElementById("result3").innerHTML=n.toFixed(6)+" km"}}function deleteMarkersAndPath(){markers[0].setMap(null),markers[1].setMap(null),markers=[],latitud=[],longitud=[],camino=[],elevator=[],elevations=[],altura=[],path=poly.setPath([]),document.getElementById("transmisor").value="",document.getElementById("receptor").value="",document.getElementById("result3").innerHTML="",document.getElementById("elevation_chart").innerHTML="",document.getElementById("elevation_chart2").innerHTML=""}dragElement(document.getElementById("Boton"));var labels="AB",labelIndex=0,markers=[],latitud=[],longitud=[],radius=6371,camino=[],altura=[],coordenadas=[],mitad_cantmuestras=0,posic_puntoMax=0,valor_puntoMax=0;function initMap(){var t=new google.maps.Map(document.getElementById("map"),{zoom:15,center:{lat:-34.916467,lng:-56.154272}});google.maps.event.addListener(t,"click",function(e){markers.length<=1&&addMarkersAndAll(e.latLng,t)}),poly=new google.maps.Polyline({strokeColor:"#000000",strokeOpacity:1,strokeWeight:3})}function geocodeLatLng(e,a){console.log("test2");var t=document.getElementById("transmisor").value.split(",",2),n={lat:parseFloat(t[0]),lng:parseFloat(t[1])};e.geocode({location:n},function(e,t){if("OK"===t)if(e[0]){new google.maps.Marker({position:n,map:a});addMarkersAndAll(location,a)}else window.alert("No results found");else window.alert("Geocoder failed due to: "+t)})}function haversine(e,t,a){var n=ToRadians(t[0]),o=ToRadians(a[0]),l=ToRadians(t[1]),i=n-l,d=o-ToRadians(a[1]),r=Math.sin(i/2),s=Math.sin(d/2),g=Math.pow(r,2)+Math.cos(n)*Math.cos(l)*Math.pow(s,2);return 2*e*Math.asin(Math.min(1,Math.sqrt(g)))}function toggleBounce(){marker.setAnimation(google.maps.Animation.BOUNCE)}function toDegrees(e){return 180*e/Math.PI}function ToRadians(e){return e*(Math.PI/180)}google.load("visualization","1",{packages:["columnchart"]});