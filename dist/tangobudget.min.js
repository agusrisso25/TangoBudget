/*! tangobudget 2019-04-06 */

function addMarkersAndAll(e,a){path=poly.getPath(),path.push(e);var n=new google.maps.Marker({position:e,label:labels[labelIndex++%labels.length],map:a,draggable:!0,animation:google.maps.Animation.DROP,title:"#"+path.getLength()});markers.push(n),poly.setMap(a),latitud.push(n.getPosition().lat()),longitud.push(n.getPosition().lng()),showCoordenadas(latitud,longitud),google.maps.event.addListener(n,"dragend",function(e){if("R"==n.getLabel())path.pop(),path.push(e.latLng),path=poly.getPath(),latitud[1]=n.getPosition().lat(),longitud[1]=n.getPosition().lng(),table_div&&link&&(document.getElementById("result_table").innerHTML="",document.getElementById("link").innerHTML="");else{var a=path.removeAt(1);path.removeAt(0);path.setAt(1,a),path.setAt(0,e.latLng),path=poly.getPath(),latitud[0]=n.getPosition().lat(),longitud[0]=n.getPosition().lng(),table_div&&link&&(document.getElementById("result_table").innerHTML="",document.getElementById("link").innerHTML="")}if(flag=2,showCoordenadas(latitud,longitud),2==markers.length){var t=new google.maps.ElevationService;camino[0]=path.getAt(0),camino[1]=path.getAt(1),dist=haversine(radius,latitud,longitud),displayPathElevation(camino,t,dist)}}),n.addListener("click",toggleBounce),2==markers.length&&(elevator=new google.maps.ElevationService,camino[0]=path.getAt(0),camino[1]=path.getAt(1),dist=haversine(radius,latitud,longitud),displayPathElevation(camino,elevator,dist))}function Bullington(e){var a,t,n,l,r,o;a=3*Math.pow(10,8)/Inputfreq;var d,u,s,m,c=0,p=0;for(i=0;i<distanciaFresnel.length;i++)c<(t=(alturaFresnel[i]-altura[0])/distanciaFresnel[i])&&(c=t),o=altura[0];for(j=0;j<distanciaFresnel.length;j++)n=(altura[altura.length-1]-alturaFresnel[j])/(1e3*e-distanciaFresnel[j]),l=altura[altura.length-1]-1e3*e*((altura[altura.length-1]-alturaFresnel[j])/(1e3*e-distanciaFresnel[j])),p<n&&(p=n,r=l);return OIficticio=Math.floor((r-o)/(c-p)),h_OIficticio=c*OIficticio+o,m=1e3*e-(s=10*OIficticio),d=Math.abs(s/Math.cos(c)),u=Math.abs(m/Math.cos(p)),v=h_OIficticio*Math.sqrt(2/a*(1/d+1/u)),v<-.78?0:6.9+20*Math.log10(Math.sqrt(Math.pow(v-.1,2)+1)+v-.1)}function DispCanalBarnett(e,a){var t,n,l=parseNumber(document.getElementById("FactorRugosidad").value),r=parseNumber(document.getElementById("FactorClima").value);if(0!=l){if(t=[0,4,1,.25][l],0!=r)return n=[0,1,.5,.25,.125][r],1-6*Math.pow(e,3)*t*n*Inputfreq/Math.pow(10,7+a/10);alert("Favor de completar el Factor Clima.")}else alert("Favor de completar el factor de rugosidad.")}function DispCanalITU(e,a,t){var n,l,r,o,i,d;return n=altura[0]<altura[altura.length-1]?altura[0]:altura[altura.length-1],l=Math.pow(10,-4.4- -1.08)*Math.pow(15.9,-.46),r=Math.abs((altura[0]-altura[altura.length-1])/e),i=100*(1-(o=l*Math.pow(e,3.4)*Math.pow(1+r,-1.03)*Math.pow(Inputfreq,.8)*Math.pow(10,-76e-5*n-a/10))),dispanual=PasajeAnual(e,r,o),d=indispMin(dispanual),[i,dispanual,d]}function DispCanalLLuvia(e,a){var t,n,l=.12+.4*Math.log10(Math.pow(Inputfreq/10,.8)),r=a/e,o=[],i=0,d=[];if(0!=e){t=Inputfreq<10?.12:l;var u,s=Math.pow(.07,t)*Math.pow(.12,1-t),c=.855*t+.546*(1-t),p=.139*t+.043*(1-t);for(i=0,n=.01;n>Math.pow(10,-7);n-=1e-6)o[i]=n,ec2[i]=s*Math.pow(n,-(c+p*Math.log10(n))),d[i]=ec2[i],i++;d.sort();for(m=0;d[m]<r;m++)u=d[m];return 100-o[ec2.indexOf(u)]}}function Fresnel(e,a){var t;if(Inputfreq){t=2.998*Math.pow(10,8)/(Inputfreq*Math.pow(10,9));var n=1e3*haversine(radius,latitud,longitud),l=n/2,r=(-altura2[0]+altura2[altura2.length-1])/n*(n/2)+altura2[0],o=Math.atan2(altura2[altura2.length-1]-altura2[0],n),i=l/Math.cos(-2/n*(altura2[0]-r)/n),d=l/Math.cos(-2/n*(altura2[altura2.length-1]-r)/n);R1=Math.sqrt(t*i*d/(i+d));var u,s=.6*R1,m=.4*R1;if(r<a)u=2;else{var c=Math.pow(Math.cos(o)*(e-l)+Math.sin(o)*(a-r),2)/(Math.pow(s,2)+Math.pow(d,2))+Math.pow(Math.sin(o)*(e-l)-Math.cos(o)*(a-r),2)/Math.pow(s,2),p=Math.pow(Math.cos(o)*(e-l)+Math.sin(o)*(a-r),2)/(Math.pow(m,2)+Math.pow(d,2))+Math.pow(Math.sin(o)*(e-l)-Math.cos(o)*(a-r),2)/Math.pow(m,2);p<1&&0<p?u=2:1<=p&&c<1?u=1:1<c&&(u=0)}return u}alert("Ingrese una frecuencia")}function FSL(e){Math.pow(10,8);var a=1e3*Inputfreq;return(32.4+20*Math.log10(a*e)).toFixed(3)}function getFreq(){Inputfreq=parseNumber(document.getElementById("frecuencia").value);var e=0;for(i=1;i<altura.length-1;i++)hayDespejeCamino[i]=Fresnel(10*i,altura2[i]),1==hayDespejeCamino[i]&&(distanciaFresnel[e]=i,alturaFresnel[e]=altura2[i],e++);var a=hayDespejeCamino.sort();despeje&&0!=despeje.length?(despeje.sort(),0==a[hayDespejeCamino.length-2]&&0==despeje[despeje.length-1]?(document.getElementById("Fresnel").innerHTML="Se tiene un despeje mayor o igual al 60%",fresnelGlobal=0):1==a[hayDespejeCamino.length-2]&&0==despeje[despeje.length-1]?(document.getElementById("Fresnel").innerHTML="Se tiene obstrucción entre el 40% y 60%",fresnelGlobal=1):0==a[hayDespejeCamino.length-2]&&1==despeje[despeje.length-1]?(document.getElementById("Fresnel").innerHTML="Se tiene obstrucción entre el 40% y 60%",fresnelGlobal=1):1==a[hayDespejeCamino.length-2]&&1==despeje[despeje.length-1]?(document.getElementById("Fresnel").innerHTML="Se tiene obstrucción entre el 40% y 60%",fresnelGlobal=1):2==a[hayDespejeCamino.length-2]||2==despeje[despeje.length-1]?(document.getElementById("Fresnel").innerHTML="No hay despeje de fresnel. El 40% se encuentra obstruido.",fresnelGlobal=2):document.getElementById("Fresnel").innerHTML=""):0==a[hayDespejeCamino.length-2]?(document.getElementById("Fresnel").innerHTML="Se tiene un despeje mayor o igual al 60%",fresnelGlobal=0):1==a[hayDespejeCamino.length-2]?(document.getElementById("Fresnel").innerHTML="Se tiene obstrucción entre el 40% y 60%",fresnelGlobal=1):2==a[hayDespejeCamino.length-2]?(document.getElementById("Fresnel").innerHTML="No hay despeje de fresnel. El 40% se encuentra obstruido.",fresnelGlobal=2):document.getElementById("Fresnel").innerHTML="No se pudo medir"}function indispMin(e){return 525600*(100-e)/100}function InputUser(){if(2==fresnelGlobal)return alert("El 40% del Fresnel está obstruido. Por favor mejorar las alturas de las antenas para avanzar"),void(table_div&&link&&(document.getElementById("result_table").innerHTML="",document.getElementById("link").innerHTML=""));var e=parseNumber(document.getElementById("gananciatx").value),a=parseNumber(document.getElementById("gananciarx").value),t=parseNumber(document.getElementById("potenciatx").value);if(""!=e&&""!=t&&""!=a){var n,l,r,o,i,d,u,s,m=haversine(radius,latitud,longitud);"0"==document.getElementById("polarizacion").value&&alert("Ingrese una polarización");var c=parseNumber(document.getElementById("perdidasconectores").value),p=parseNumber(document.getElementById("otrasperdidas").value),g=FSL(m);g=parseFloat(g);var v=AtenuacionLluvia(),h=Tilt(m),f=h[0],y=h[1],F=0;1==fresnelGlobal&&(F=Bullington(m).toFixed(8));var b=parseFloat(e)+parseFloat(a)+parseFloat(t)-parseFloat(c)-parseFloat(g)-parseFloat(p)-parseFloat(F);b=b.toFixed(2);var M=parseFloat(document.getElementById("sensibilidadrx").value);if(0<M||""==M)alert("Debe ingresar una Sensibilidad de Recepción correcta");else{if(M<b){(n=b-M)<30&&alert("Se recomienda tener un Margen de Fading mayor a 30 dB");var I=DispCanalITU(m,n,v);r=I[0],o=I[1],d=I[2],u=525600*(100-(l=100-(100-o+(100-(i=DispCanalLLuvia(v,n))))))/100,99.998<=l?s=0:(alert("Cuidado! Se recomienda verificar la disponibilidad del canal total.\n Se recomienda verificar: \n 1. Altura de las antenas \n 2.Acortar la distancia entre las antenas  \n 3. Frecuencia de transmisión \n 4. Mejorar el Margen de Fading "),s=1)}else alert("Ten cuidado! La potencia de recepción es menor a la sensibilidad. \n Con estos valores el enlace no es aceptable.\n Se sugiere tomar cualquiera de las siguientes opciones: \n 1. Aumentar la potencia de Transmisión \n 2. Aumentar la ganancia de las antenas \n 3. Acortar la distancia entre las antenas \n 4. Disminuir la frecuencia de transmisión"),document.getElementById("result_table").innerHTML="",document.getElementById("link").innerHTML="",s=1;if(1==hayLOS||"Si"==hayLOS)hayLOS="Si";else{if(0!=hayLOS&&"No"!=hayLOS)return;hayLOS="No"}Resultados(i,r,o,d,l,u,f,y,e,a,t,b,n,M,m,g,v,c,p,F,s),print(i,r,o,d,l,u,f,y,e,a,t,b,n,M,m,g,v,c,p,F,s)}}else alert("Ingrese la información obligatoria")}function getArrayLast(e,a){return a=a||0,e[e.length-1-a]}function LOS(e,a){var t,n,l=altura2.indexOf(getArrayLast(data.getDistinctValues(1).filter(function(e){return!isNaN(e)})));if(0!=l&&l!=altura2.length-1){var r=parseFloat(getArrayLast(data.getDistinctValues(1),0).toFixed(3));return r>altura2[altura2.length-1].toFixed(3)&&r>altura2[0].toFixed(3)?0:parseFloat(altura2[0].toFixed(3))<r&&r<parseFloat(altura2[altura2.length-1].toFixed(3))?(t=(altura2[altura2.length-1].toFixed(3)-altura2[0].toFixed(3))/(altura2.length-1-0),(r-altura2[0].toFixed(3))/(l-0)<=t?1:0):parseFloat(altura2[altura2.length-1].toFixed(3))<r&&r<parseFloat(altura2[0].toFixed(3))?(t=(altura2[altura2.length-1].toFixed(3)-altura2[0].toFixed(3))/(altura2.length-1-0),(r-altura2[0].toFixed(3))/(l-0)<t?1:0):1}if(0==l||l==altura2.length-1){if(0==(n=parseFloat(altura2.indexOf(getArrayLast(data.getDistinctValues(1),1))))||n==altura2.length-1){var o=parseFloat(getArrayLast(data.getDistinctValues(1),2).toFixed(1)),i=altura2.indexOf(getArrayLast(data.getDistinctValues(1),2));return o>parseFloat(altura2[altura2.length-1].toFixed(3))&&o>parseFloat(altura2[0].toFixed(3))?0:parseFloat(altura2[0].toFixed(3))<o&&o<parseFloat(altura2[altura2.length-1].toFixed(3))?(t=(altura2[altura2.length-2].toFixed(3)-altura2[0].toFixed(3))/(altura2.length-1-0),(o-altura2[0].toFixed(3))/(i-0)<=t?1:0):parseFloat(altura2[altura2.length-1].toFixed(3))<o&&o<parseFloat(altura2[0].toFixed(3))?(t=(altura2[altura2.length-1].toFixed(3)-altura2[0].toFixed(3))/(altura2.length-1-0),(o-altura2[0].toFixed(3))/(i-0)<t?1:0):1}var d=parseFloat(getArrayLast(data.getDistinctValues(1),1).toFixed(1));return d>parseFloat(altura2[altura2.length-1].toFixed(3)&&d>altura2[0].toFixed(3))?0:parseFloat(altura2[0].toFixed(3))<d&&d<parseFloat(altura2[altura2.length-1].toFixed(3))?(t=(altura2[altura2.length-1].toFixed(3)-altura2[0].toFixed(3))/(altura2.length-1-0),(d-altura2[0].toFixed(3))/(n-0)<=t?1:0):parseFloat(altura2[altura2.length-1].toFixed(1))<d&&d<parseFloat(altura2[0].toFixed(1))?(t=(altura2[altura2.length-1].toFixed(1)-altura2[0].toFixed(1))/(altura2.length-1-0),(d-altura2[0].toFixed(1))/(n-0)<t?1:0):1}}function ModifyHeight(){if(distanciaobject=parseNumber(document.getElementById("distanciaobjeto").value),distanciatotal=1e3*haversine(radius,latitud,longitud),muestra_mod[contador]=Math.floor(distanciaobject/10),0==muestra_mod[contador]||muestra_mod[contador]==cant_redondeo-1)alert("No se pueden colocar objetos interferentes en las antenas");else if(0<distanciaobject&&distanciaobject<distanciatotal&&null!=parseInt(document.getElementById("objetointerferente").value)){for(flag=1,i=0;i<contador;i++)if(muestra_mod[contador]==muestra_mod[i])return void alert("No se puede agregar otro OI en esta ubicación, intente de nuevo");displayPathElevation(camino,elevator,dist)}else alert("distancia excede el largo del camino")}function ModifyRxTx(){var e=parseNumber(document.getElementById("alturaantenatx").value),a=parseNumber(document.getElementById("alturaantenarx").value);e<5&&a<5?(a=e=5,document.getElementById("alturaantenarx").value="5",document.getElementById("alturaantenatx").value="5"):5<e&&a<5?(a=5,document.getElementById("alturaantenarx").value="5"):e<5&&5<a&&(e=5,document.getElementById("alturaantenatx").value="5"),flag=4,displayPathElevation(camino,elevator,dist)}function PasajeAnual(e,a,t){var n=10.5-5.6*Math.log10(1.1-Math.pow(Math.abs(Math.cos(2)),.7))-2.7*Math.log10(e)+1.7*Math.log10(1+Math.abs(a));return 100*(1-Math.pow(10,-n/10)*t)}function AtenuacionLluvia(){var e,a,t=parseNumber(document.getElementById("polarizacion").value),n=haversine(radius,latitud,longitud);if(Inputfreq){var l=[1,1.5,2,2.5,3,3.5,4,4.5,5,5.5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,120,150,200,300,400,500,600,700,800,900,1e3],r=l.indexOf(Inputfreq);if(-1==r){for(var o=0;Inputfreq>=l[o];)o++;a=l[o],console.log("Se aproximó dicho valor a"+a+"GHz para calcular la atenuación por lluvia."),r=o}var i=document.getElementById("ZonaHidrometeorologica").value,d=["A","B","C","D","E","F","G","H","J","K","L","M","N","P","Q"].indexOf(i);"0"==i?alert("Por favor ingresar el zona hidrometeorológica para el cálculo de lluvia."):e=[8,12,15,19,22,28,30,32,35,42,60,63,95,145,115][d];var u,s;if(1==t)u=[308e-7,574e-7,998e-7,146e-6,194e-6,235e-6,246e-6,235e-6,243e-6,312e-6,488e-6,.001425,.00345,.006691,.01129,.01731,.02455,.03266,.04126,.05008,.05899,.06797,.07708,.08642,.09611,.1063,.117,.1284,.1404,.1533,.1669,.1813,.1964,.2124,.2291,.2465,.2646,.2833,.3026,.3224,.3427,.3633,.3844,.4058,.4274,.4492,.4712,.4932,.5153,.5375,.5596,.5817,.6037,.6255,.6472,.6687,.6901,.7112,.7321,.7527,.773,.7931,.8129,.8324,.8515,.8704,.8889,.9071,.925,.9425,.9598,.9767,.9932,1.0094,1.0253,1.0409,1.0561,1.0711,1.0857,1.1,1.1139,1.1276,1.141,1.1541,1.1668,1.1793,1.1915,1.2034,1.2151,1.2265,1.2376,1.2484,1.259,1.2694,1.2795,1.2893,1.2989,1.3083,1.3175,1.3265,1.3352,1.3437,1.352,1.3601,1.368,1.4911,1.5896,1.6443,1.6286,1.582,1.5366,1.4967,1.4622,1.4321,1.4056,1.3822][r],s=[.8592,.8957,.949,1.0085,1.0688,1.1387,1.2476,1.3987,1.5317,1.5882,1.5728,1.4745,1.3797,1.2895,1.2156,1.1617,1.1216,1.0901,1.0646,1.044,1.0273,1.0137,1.0025,.993,.9847,.9771,.97,.963,.9561,.9491,.9421,.9349,.9277,.9203,.9129,.9055,.8981,.8907,.8834,.8761,.869,.8621,.8552,.8486,.8421,.8357,.8296,.8236,.8179,.8123,.8069,.8017,.7967,.7918,.7871,.7826,.7783,.7741,.77,.7661,.7623,.7587,.7552,.7518,.7486,.7454,.7424,.7395,.7366,.7339,.7313,.7287,.7262,.7238,.7215,.7193,.7171,.715,.713,.711,.7091,.7073,.7055,.7038,.7021,.7004,.6988,.6973,.6958,.6943,.6929,.6915,.6902,.6889,.6876,.6864,.6852,.684,.6828,.6817,.6806,.6796,.6785,.6775,.6765,.6609,.6466,.6343,.6262,.6256,.6272,.6293,.6315,.6334,.6351,.6365][r];else{if(2!=t)return void alert("Ingrese un tipo de polarización");u=[259e-7,443e-7,847e-7,132e-6,139e-6,116e-6,107e-6,134e-6,216e-6,391e-6,706e-6,.001915,.004115,.007535,.01217,.01772,.02386,.03041,.03738,.04481,.05282,.06146,.07078,.08084,.09164,.1032,.1155,.1286,.1425,.1571,.1724,.1884,.2051,.2224,.2403,.2588,.2778,.2972,.3171,.3374,.358,.3789,.4001,.4215,.4431,.4647,.4865,.5084,.5302,.5521,.5738,.5956,.6172,.6386,.66,.6811,.702,.7228,.7433,.7635,.7835,.8032,.8226,.8418,.8606,.8791,.8974,.9153,.9328,.9501,.967,.9836,.9999,1.0159,1.0315,1.0468,1.0618,1.0764,1.0908,1.1048,1.1185,1.132,1.1451,1.1579,1.1704,1.1827,1.1946,1.2063,1.2177,1.2289,1.2398,1.2504,1.2607,1.2708,1.2807,1.2903,1.2997,1.3089,1.3179,1.3266,1.3351,1.3434,1.3515,1.3594,1.3671,1.4866,1.5823,1.6378,1.6286,1.586,1.5418,1.5013,1.4654,1.4335,1.405,1.3795][r],s=[.9691,1.0185,1.0664,1.1209,1.2322,1.4189,1.6009,1.6948,1.6969,1.6499,1.59,1.481,1.3905,1.3155,1.2571,1.214,1.1825,1.1586,1.1396,1.1233,1.1086,1.0949,1.0818,1.0691,1.0568,1.0447,1.0329,1.0214,1.0101,.9991,.9884,.978,.9679,.958,.9485,.9392,.9302,.9214,.9129,.9047,.8967,.889,.8816,.8743,.8673,.8605,.8539,.8476,.8414,.8355,.8297,.8241,.8187,.8134,.8084,.8034,.7987,.7941,.7896,.7853,.7811,.7771,.7731,.7693,.7656,.7621,.7586,.7552,.752,.7488,.7458,.7428,.74,.7372,.7345,.7318,.7293,.7268,.7244,.7221,.7199,.7177,.7156,.7135,.7115,.7096,.7077,.7058,.704,.7023,.7006,.699,.6974,.6959,.6944,.6929,.6915,.6901,.6888,.6875,.6862,.685,.6838,.6826,.6815,.664,.6494,.6382,.6296,.6262,.6253,.6262,.6284,.6315,.6353,.6396][r]}var m=u*Math.pow(e,s),c=(Math.exp(-.015*e),m*(n*(1/(.477*Math.pow(n,.633)*Math.pow(e,.073*s)*Math.pow(Inputfreq,.123)-10.579*(1-Math.exp(-.024*n))))));return(c=c.toFixed(3))<0&&(c=0),c}alert("Ingrese una frecuencia")}function populateTable(e){for(var a=document.getElementById("result_table"),t=a.innerHTML="",n=0;n<Object.keys(e).length;n++){t+="<tr><td>"+e[n].name+"</td><td>"+e[n].value+"</td></tr>"}a.innerHTML=t}function Resultados(e,a,t,n,l,r,o,i,d,u,s,m,c,p,g,v,h,f,y,F,b){var M=altura[0].toFixed(2)+" metros",I=altura[altura.length-1].toFixed(2)+" metros",B=(document.getElementById("dimensionestx").value,document.getElementById("dimensionesrx").value,parseNumber(document.getElementById("polarizacion").value));y=parseFloat(y),f=parseFloat(f),v=parseFloat(v),F=parseFloat(F),g=g.toFixed(3),0==b?b="Enlace Aceptable":1==b&&(b="Enlace NO Aceptable"),populateTable([{name:"Altura total del Transmisor (m) ",value:M},{name:"Altura total del Receptor (m) ",value:I},{name:"Ganancia del Transmisor (dBi)",value:d},{name:"Ganancia del Receptor (dBi) ",value:u},{name:"Potencia del Transmisor (dBm) ",value:s},{name:"Sensibilidad de Recepción (dBm) ",value:p},{name:"Frecuencia (GHz) ",value:Inputfreq},{name:"Largo del camino (Km) ",value:g},{name:"Polarizacion ",value:B=1==B?"Vertical":"Horizontal"},{name:"",value:""},{name:"Angulo Tilt Antena Transmisora (grados)",value:o},{name:"Angulo Tilt Antena Receptora (grados)",value:i},{name:"Potencia del Receptor (dBm)",value:m},{name:"Pérdidas de Espacio Libre (dB)",value:v},{name:"Margen de Fading (dB)",value:c},{name:"Pérdidas por Lluvia (dB)",value:h},{name:"Pérdidas de Conectores (dB)",value:f},{name:"Otras Pérdidas (dB)",value:y},{name:"Pérdidas por Bullington (dB)",value:F},{name:"TOTAL DE PERDIDAS (dB)",value:v+y+f+F},{name:"",value:""},{name:"Hay linea de vista?",value:hayLOS},{name:"Despeje de Fresnel",value:0==fresnelGlobal?"Mayor o igual a 60%":1==fresnelGlobal?"Entre el 40% y 60%":"No hay despeje de Fresnel"},{name:"",value:""},{name:"Disponibilidad de Canal del peor mes por Multi Camino(%)",value:a.toFixed(8)},{name:"Disponibilidad de Canal anual por Multi Camino(%)",value:t.toFixed(8)},{name:"Indisponibilidad anual (min)",value:n.toFixed(8)},{name:"Disponibilidad de Canal anual por lluvia (%)",value:e.toFixed(8)},{name:"Disponibilidad Total del Canal (Multi Camino + Lluvia) (%)",value:l.toFixed(8)},{name:"Disponibilidad Total de Canal (min)",value:r.toFixed(8)},{name:"",value:""},{name:"Disponibilidad del enlace",value:b}])}function AgregarTabla(t){google.charts.load("current",{packages:["table"]}),google.charts.setOnLoadCallback(function(){data_detabla||((data_detabla=new google.visualization.DataTable).addColumn("string","Tipo"),data_detabla.addColumn("number","Distancia desde el Tx (m)"),data_detabla.addColumn("number","Altura (m)"),data_detabla.addColumn("boolean","Despeje 60%?"),data_detabla.addColumn("boolean","Despeje 40%?"),data_detabla.addColumn("number","Muestra Modificada"),table=new google.visualization.Table(document.getElementById("table_div")));var e,a;0==resFresnel?(console.log("Existe un despeje del 60% de Fresnel."),a=e=!0):1==resFresnel?(console.log("Existe el despeje entre el 40% y 60% del Fresnel."),a=!(e=!1)):(console.log("No hay despeje de Fresnel."),a=e=!1);data_detabla.addRow([t,+parseNumber(document.getElementById("distanciaobjeto").value),+parseNumber(document.getElementById("alturaobjeto").value),e,a,+muestra_mod[contador-1]]),table.draw(data_detabla,{showRowNumber:!0,width:"100%",height:"100%"}),document.getElementById("alturaobjeto").value="",document.getElementById("distanciaobjeto").value=""})}function BorrarFila(){data_detabla.removeRow(muestra_mod.length-1),table.draw(data_detabla,{showRowNumber:!0,width:"100%",height:"100%"})}function Tilt(e){var a,t;return a=Math.atan2(altura[altura.length-1]-altura[0],e),t=Math.atan2(altura[0]-altura[altura.length-1],-e),[a.toFixed(2),t.toFixed(2)]}function DeshacerAltura(){var e;return 1<=contador?(flag=3,void displayPathElevation(camino,elevator,dist)):(alert("Ya se deshicieron todos los cambios."),void(0==(e=hayDespejeCamino.sort())[hayDespejeCamino.length-2]?(document.getElementById("Fresnel").innerHTML="Se tiene un despeje del 60%",fresnelGlobal=0):1==e[hayDespejeCamino.length-2]?(document.getElementById("Fresnel").innerHTML="Se tiene un despeje entre el 40% y 60%",fresnelGlobal=1):2==e[hayDespejeCamino.length-2]?(document.getElementById("Fresnel").innerHTML="No hay despeje de fresnel",fresnelGlobal=2):document.getElementById("Fresnel").innerHTML="No se pudo medir"))}function avoidExecutionOverlap(e){var a=!1;return function(){if(!a){a=!0;try{e.apply(this,arguments)}finally{a=!1}}}}var displayPathElevation=avoidExecutionOverlap(function(e,a,t){if(5<t)cant_redondeo=500;else{var n=100*t;cant_redondeo=Math.floor(n)}a.getElevationAlongPath({path:e,samples:cant_redondeo},plotElevation)}),plotElevation=avoidExecutionOverlap(function(e,a){if(chartDiv=document.getElementById("elevation_chart"),"OK"===a){var t;if(!data||2==flag){2==flag&&resetDrag(),data=new google.visualization.DataTable,chart=new google.visualization.ColumnChart(chartDiv),data.addColumn("string","Sample"),data.addColumn("number","Elevation");for(var n=0;n<e.length;n++){if(data.addRow(["",e[n].elevation]),"undefined"==data.getValue(n,1)&&(coordenadas[n]=NaN,altura[n]=NaN),altura.filter(function(e){return e!=isNaN}).length/altura.length<.8)return void alert("Vuelva a recargar la página, hay pérdida de información en el perfil de elevación.");altura[n]=data.getValue(n,1),altura2[n]=altura[n],coordenadas[n]=e[n].location}flag=0}if(0==flag);else if(1==flag){var l,r=parseFloat(altura[muestra_mod[contador]])+parseNumber(document.getElementById("alturaobjeto").value);document.getElementById("distanciaobjeto").value;if(valuetomodify_array[contador]=parseFloat(altura[muestra_mod[contador]])+parseFloat(document.getElementById("alturaobjeto").value),distanciaobject_array[contador]=parseFloat(document.getElementById("distanciaobjeto").value),resFresnel=Fresnel(distanciaobject_array[contador],r),fresnelOI_array[contador]=resFresnel,despeje[contador]=Fresnel(distanciaobject_array[contador],r),1==despeje[contador]&&(l=distanciaFresnel.length,distanciaFresnel[l]=muestra_mod[contador],alturaFresnel[l]=r),data.setValue(muestra_mod[contador],1,r),altura2[muestra_mod[contador]]=r,contador++,objInterferente=document.getElementById("objetointerferente").value,!objInterferente)return alert("Ingrese un tipo de interferencia"),void(flag=0);"arbol"==objInterferente?objInterferente="Arbol":"edificio"==objInterferente?objInterferente="Edificio":"Otro"==objInterferente&&(objInterferente="Otro"),AgregarTabla(objInterferente),flag=0}else if(3==flag){data.setValue(muestra_mod[contador-1],1,altura[muestra_mod[contador-1]]),altura2[muestra_mod[contador-1]]=altura[muestra_mod[contador-1]],BorrarFila();var o=despeje.indexOf(fresnelOI_array[contador-1]);despeje.splice(o,1),fresnelOI_array.pop(),muestra_mod.pop(),valuetomodify_array.pop(),distanciaobject_array.pop(),contador--,flag=0}else 4==flag&&(AlturaIni||(AlturaIni=data.getValue(0,1),AlturaFin=data.getValue(altura.length-1,1)),data.setValue(0,1,parseFloat(document.getElementById("alturaantenatx").value)+AlturaIni),data.setValue(altura.length-1,1,parseFloat(document.getElementById("alturaantenarx").value)+AlturaFin),altura[0]=AlturaIni+parseFloat(document.getElementById("alturaantenatx").value),altura[altura.length-1]=AlturaFin+parseFloat(document.getElementById("alturaantenarx").value),altura2[0]=AlturaIni+parseFloat(document.getElementById("alturaantenatx").value),altura2[altura.length-1]=AlturaFin+parseFloat(document.getElementById("alturaantenarx").value),flag=0,Inputfreq&&getFreq());chart.draw(data,{height:200,legend:"none",titleX:"Cantidad de muestras",titleY:"Elevación (m)"}),despeje&&0!=despeje.length?0==(t=despeje.sort())[despeje.length-1]?(fresnelGlobal=0,document.getElementById("Fresnel").innerHTML="Se tiene un despeje mayor o igual al 60%"):1==t[despeje.length-1]?(fresnelGlobal=1,document.getElementById("Fresnel").innerHTML="Se tiene obstrucción entre el 40% y 60%"):2==t[despeje.length-1]?(fresnelGlobal=2,document.getElementById("Fresnel").innerHTML="No hay despeje de fresnel. El 40% se encuentra obstruido."):(document.getElementById("Fresnel").innerHTML=" ",fresnelGlobal=-1):0==(t=hayDespejeCamino.sort())[hayDespejeCamino.length-2]?(document.getElementById("Fresnel").innerHTML="Se tiene un despeje mayor o igual al 60%",fresnelGlobal=0):1==t[hayDespejeCamino.length-2]?(document.getElementById("Fresnel").innerHTML="Se tiene obstrucción entre el 40% y 60%",fresnelGlobal=1):2==t[hayDespejeCamino.length-2]?(document.getElementById("Fresnel").innerHTML="No hay despeje de fresnel. El 40% se encuentra obstruido.",fresnelGlobal=2):(document.getElementById("Fresnel").innerHTML=" ",fresnelGlobal=-1),1==(hayLOS=LOS(e,coordenadas))?document.getElementById("Ldevista").innerHTML="¡Hay línea de vista!":0==hayLOS&&(document.getElementById("Ldevista").innerHTML="¡Cuidado! No hay línea de vista. Se sugiere aumentar las alturas de las antenas.")}else chartDiv.innerHTML="No se pudo calcular el perfil de elevación porque: "+a});function showCoordenadas(e,a){for(var t=0;t<markers.length;t++)document.getElementById("transmisor").value=e[0]+", "+a[0],document.getElementById("receptor").value=e[1]+", "+a[1];if(0!==e[0]&&0!==e[1]){var n=haversine(radius,e,a);document.getElementById("result3").innerHTML=n.toFixed(6)+" km"}}function deleteMarkersAndPath(){markers[0].setMap(null),markers[1].setMap(null),markers=[],latitud=[],longitud=[],camino=[],elevator=[],elevations=[],altura=[],despeje=[],muestra_mod=[],cant_redondeo=contador=data=0,path=poly.setPath([]),document.getElementById("transmisor").value="0",document.getElementById("receptor").value="0",document.getElementById("alturaantenarx").value="0",document.getElementById("alturaantenatx").value="0",document.getElementById("result3").innerHTML="",document.getElementById("Ldevista").innerHTML="",document.getElementById("Fresnel").innerHTML="",document.getElementById("result_table").innerHTML="",document.getElementById("table_div").innerHTML="",document.getElementById("result_table").innerHTML="",document.getElementById("link").innerHTML="",document.getElementById("elevation_chart").innerHTML="",document.getElementById("link").innerHTML=""}function resetDrag(){altura=[],altura2=[],hayDespejeCamino=[],document.getElementById("alturaantenatx").value="0",document.getElementById("alturaantenarx").value="0",despeje=[],muestra_mod=[],document.getElementById("elevation_chart").innerHTML="",document.getElementById("Ldevista").innerHTML="",valuetomodify_array=[],distanciaobject_array=[],contador=0}var data,chart,chartDiv,elevator,dist,cant_redondeo,elevations,data_detabla,data_resultados,table,tableRes,hayLOS,AlturaIni,AlturaFin,resFresnel,Inputfreq,fresnelGlobal,result,labels="TR",labelIndex=0,markers=[],latitud=[],longitud=[],radius=6371,camino=[],altura=[],altura2=[],coordenadas=[],flag=0,muestra_mod=[],distanciaobject_array=[],contador=0,valuetomodify_array=[],distanciaFresnel=[],alturaFresnel=[],fresnelOI_array=[],hayDespejeCamino=[],despeje=[],ec2=[],APP={};function initMapInteractive(){var a=new google.maps.Map(document.getElementById("map"),{zoom:15,center:{lat:-34.916467,lng:-56.154272}});google.maps.event.addListener(a,"click",function(e){markers.length<=1&&addMarkersAndAll(e.latLng,a)}),poly=new google.maps.Polyline({strokeColor:"#000000",strokeOpacity:1,strokeWeight:3})}function initMapPrintable(){result=parseSearchString(),ResultadosmainB(),ResultadosmainB2();var e=result.coordtx.split(","),a=result.coordrx.split(","),t=parseFloat(e[0]),n=parseFloat(e[1]),l=parseFloat(a[0]),r=parseFloat(a[1]),o={lat:t,lng:n},i=new google.maps.Map(document.getElementById("map"),{zoom:15,center:o}),d=new google.maps.Marker({position:{lat:t,lng:n},map:i}),u=new google.maps.Marker({position:{lat:l,lng:r},map:i});d.setMap(i),u.setMap(i);var s=[{lat:t,lng:n},{lat:l,lng:r}];new google.maps.Polyline({path:s,geodesic:!0,strokeColor:"black",strokeOpacity:1,strokeWeight:2}).setMap(i);var m,c=new google.maps.ElevationService;function p(e,a){var t,n=document.getElementById("elevation_chart"),l=new google.visualization.ColumnChart(n),r=result.altura.split(","),o=result.valuetomodify_array.split(","),i=result.muestra_mod.split(","),d=parseNumber(result.contador),u=new google.visualization.DataTable;u.addColumn("string","Sample"),u.addColumn("number","Elevation");for(var s=0;s<r.length;s++)u.addRow(["",parseFloat(r[s])]);for(t=0;t<d;t++)o[t]=parseFloat(o[t]),i[t]=parseNumber(i[t]),u.setValue(i[t],1,o[t]);l.draw(u,{height:200,width:950,alignment:"center",legend:"none",titleX:"Cantidad de muestras",titleY:"Elevación (m)"})}m=s,c.getElevationAlongPath({path:m,samples:parseNumber(result.cant_redondeo)},p)}function haversine(e,a,t){var n=ToRadians(a[0]),l=ToRadians(t[0]),r=ToRadians(a[1]),o=n-r,i=l-ToRadians(t[1]),d=Math.sin(o/2),u=Math.sin(i/2),s=Math.pow(d,2)+Math.cos(n)*Math.cos(r)*Math.pow(u,2);return 2*e*Math.asin(Math.min(1,Math.sqrt(s)))}function toggleBounce(){marker.setAnimation(google.maps.Animation.BOUNCE)}function parseSearchString(){return result={},location.search.substr(1).split("&").forEach(function(e){var a=e.split("=");result[a[0]]=a[1]}),result}function print(e,a,t,n,l,r,o,i,d,u,s,m,c,p,g,v,h,f,y,F,b){var M=latitud[0].toFixed(3)+","+longitud[0].toFixed(3),I=latitud[1].toFixed(3)+","+longitud[1].toFixed(3),B=altura[0].toFixed(2),E=altura[altura.length-1].toFixed(2),x=(document.getElementById("dimensionestx").value,document.getElementById("dimensionesrx").value,parseNumber(document.getElementById("polarizacion").value)),L=Inputfreq,j=fresnelGlobal;g=g.toFixed(3),l=l.toFixed(6),e=e.toFixed(6),a=a.toFixed(6),t=t.toFixed(6),n=n.toFixed(6),r=r.toFixed(6),document.getElementById("link").innerHTML='<a href="mainB.html?perdidasFSL='+v+"&disp_canalTOT="+l+"&disp_canalLL="+e+"&disp_mensualMC="+a+"&disp_anualMC="+t+"&indisp_anualmin="+n+"&disp_canalTOT_min="+r+"&TiltTx="+o+"&TiltRx="+i+"&Gtx="+d+"&Grx="+u+"&Ptx="+s+"&Prx="+m+"&MargenFading="+c+"&distancia="+g+"&perdidasLluvia="+h+"&perdidasConectores="+f+"&perdidasOtras="+y+"&diffBullington="+F+"&coordtx="+M+"&coordrx="+I+"&Freq="+L+"&pol="+x+"&htx="+B+"&hrx="+E+"&sensRX="+p+"&cant_redondeo="+cant_redondeo+"&altura="+altura+"&muestra_mod="+muestra_mod+"&contador="+contador+"&valuetomodify_array="+valuetomodify_array+"&fresnelGlobal="+j+"&enlace="+b+"&hayLOS="+hayLOS+'" target="_blank">Haga click aquí para imprimir la página de resultados</a>'}function ResultadosmainB(){var e=result.pol;e=1==e?"Vertical":"Horizontal",document.getElementById("transmisormainB").value="("+result.coordtx+")",document.getElementById("receptormainB").value="("+result.coordrx+")",document.getElementById("distmainB").innerHTML=result.distancia+" km","0"==result.fresnelGlobal||result.fresnelGlobal,"0"==result.enlace||result.enlace;var a=parseFloat(result.perdidasFSL)+parseFloat(result.perdidasOtras)+parseFloat(result.perdidasConectores)+parseFloat(result.diffBullington);!function(e){var a=document.getElementById("result_table_mainB");a.innerHTML="";for(var t=0;t<Object.keys(e).length;t++){var n="<tr><td>"+e[t].name+"</td><td>"+e[t].value+"</td></tr>";a.innerHTML+=n}}([{name:"",value:""},{name:"Altura total del Transmisor (m) ",value:result.htx},{name:"Altura total del Receptor (m) ",value:result.hrx},{name:"Ganancia del Transmisor (dBi)",value:result.Gtx},{name:"Ganancia del Receptor (dBi) ",value:result.Grx},{name:"Potencia del Transmisor (dBm) ",value:result.Ptx},{name:"Sensibilidad de Recepción (dBm) ",value:result.sensRX},{name:"Frecuencia (GHz) ",value:result.Freq},{name:"Polarizacion ",value:e},{name:"",value:""},{name:"Angulo Tilt Antena Transmisora (grados)",value:result.TiltTx},{name:"Angulo Tilt Antena Receptora (grados)",value:result.TiltRx},{name:"Potencia del Receptor (dBm)",value:result.Prx},{name:"Pérdidas de Espacio Libre (dB)",value:result.perdidasFSL},{name:"Pérdidas por Fading (dB)",value:result.MargenFading},{name:"Pérdidas por Lluvia (dB)",value:result.perdidasLluvia},{name:"Pérdidas de Conectores (dB)",value:result.perdidasConectores},{name:"Otras Perdidas (dB)",value:result.perdidasOtras},{name:"Pérdidas por Bullington (dB)",value:result.diffBullington},{name:"TOTAL DE PERDIDAS (dB)",value:a},{name:"",value:""}])}function ResultadosmainB2(){var e,a,t=result.pol;t=1==t?"Vertical":"Horizontal",document.getElementById("transmisormainB").value="("+result.coordtx+")",document.getElementById("receptormainB").value="("+result.coordrx+")",document.getElementById("distmainB").innerHTML=result.distancia+" km",e="0"==result.fresnelGlobal?"Mayor o igual a 60%":"1"==result.fresnelGlobal?"Entre el 40% y 60%":"No hay despeje de Fresnel","0"==result.enlace?a="Enlace Aceptable":"1"==result.enlace&&(a="Enlace no Aceptable"),function(e){var a=document.getElementById("result_table_mainB2");a.innerHTML="";for(var t=0;t<Object.keys(e).length;t++){var n="<tr><td>"+e[t].name+"</td><td>"+e[t].value+"</td></tr>";a.innerHTML+=n}}([{name:"",value:""},{name:"Despeje de Fresnel",value:e},{name:"",value:""},{name:"Disponibilidad de Canal del peor mes por Multi Camino(%)",value:result.disp_mensualMC},{name:"Disponibilidad de Canal anual por Multi Camino(%)",value:result.disp_anualMC},{name:"Indisponibilidad anual (min)",value:result.indisp_anualmin},{name:"Disponibilidad de Canal anual por lluvia (%)",value:result.disp_canalLL},{name:"Disponibilidad Total del Canal (Multi Camino + Lluvia) (%)",value:result.disp_canalTOT},{name:"Disponibilidad Total de Canal (min)",value:result.disp_canalTOT_min},{name:"",value:""},{name:"Hay linea de vista?",value:result.hayLOS},{name:"Viabilidad del enlace",value:a},{name:"",value:""}])}function toDegrees(e){return 180*e/Math.PI}function parseNumber(e){return 0<=e.search(",")?parseFloat(e.replace(",",".")):parseFloat(e)}function ToRadians(e){return e*(Math.PI/180)}APP.objInterferente=null,google.load("visualization","1",{packages:["columnchart"]});