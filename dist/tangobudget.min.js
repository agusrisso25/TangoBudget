/*! tangobudget 2018-09-09 */

function addMarkersAndAll(t,e){path=poly.getPath(),path.push(t);var o=new google.maps.Marker({position:t,label:labels[labelIndex++%labels.length],map:e,draggable:!0,animation:google.maps.Animation.DROP,title:"#"+path.getLength()});markers.push(o),poly.setMap(e),latitud.push(o.getPosition().lat()),longitud.push(o.getPosition().lng()),showCoordenadas(latitud,longitud),google.maps.event.addListener(o,"drag",function(t){if("B"==o.getLabel())path.pop(),path.push(t.latLng),path=poly.getPath(),latitud[1]=o.getPosition().lat(),longitud[1]=o.getPosition().lng();else{var e=path.removeAt(1);path.removeAt(0);path.setAt(1,e),path.setAt(0,t.latLng),path=poly.getPath(),latitud[0]=o.getPosition().lat(),longitud[0]=o.getPosition().lng()}if(flag=2,showCoordenadas(latitud,longitud),2==markers.length){var a=new google.maps.ElevationService;camino[0]=path.getAt(0),camino[1]=path.getAt(1),dist=haversine(radius,latitud,longitud),displayPathElevation(camino,a,dist)}}),o.addListener("click",toggleBounce),2==markers.length&&(elevator||(elevator=new google.maps.ElevationService),camino[0]=path.getAt(0),camino[1]=path.getAt(1),dist=haversine(radius,latitud,longitud),displayPathElevation(camino,elevator,dist))}function Fresnel(t,e,a){var o;o=22/t;var n=haversine(radius,latitud,longitud);tan_alpha=(e-a)/n,alpha=Math.atan(tan_alpha);var l=n/2,i=l/Math.cos(alpha),d=l/Math.cos(alpha);R1=Math.sqrt(o*i*d/(i+d));var r=.8*R1,u=.6*R1,s=altura[mitad_cantmuestras];x,h,x,h;return 0}function FSL(t,e,a,o){var n;n=22/o;var l=4*Math.PI*t/n;return 20*Math.log10(l)}function InputUser(){var t=document.getElementById("gananciatx").value,e=document.getElementById("gananciarx").value,a=document.getElementById("potenciatx").value,o=document.getElementById("frecuencia").value,n=document.getElementById("disponibilidad").value/100,l=document.getElementById("alturaantenatx").value,i=document.getElementById("alturaantenarx").value,d=haversine(radius,latitud,longitud),r=document.getElementById("perdidasconectores").value,u=document.getElementById("FactorRugosidad").value,s=FSL(d,l,i,o),g=MF(d,u,.25,o,n),c=t+e+a-r-s-0,m=Tilt(dist,l+altura[0],i+altura[altura.length]);console.log("La frecuencia ingresada es: "+o),console.log("perdidasFSL: "+s),console.log("Prx es: "+c),console.log("El margen de fading es: "+g),console.log("La disponibildad del canal es: "+n),console.log("El valor de A es: "+u),console.log("El angulo del tilt es: "+m)}function LOS(t,e){var a=new google.visualization.DataTable;a.addColumn("string","Muestras"),a.addColumn("number","Elevacion");for(var o=0;o<t.length;o++)a.addRow(["",altura[o]]),"undefined"==a.getValue(o,1)&&(e[o]=0,altura[o]=0);var n,l;new google.visualization.LineChart(document.getElementById("elevation_chart2")).draw(a,{height:200,legend:"none",titleY:"Perfil de elevacion (m)"});var i=altura.indexOf(data.getDistinctValues(1)[t.length-1]);if(0!=i&&i!=t.length-1){console.log("Prueba: "+data.getDistinctValues(1)[t.length-1]);var d=data.getDistinctValues(1)[t.length-1].toFixed(3);return d>altura[t.length-1].toFixed(3)&&d>altura[0].toFixed(3)?0:altura[0].toFixed(3)<d<altura[t.length-1].toFixed(3)?(n=(altura[t.length-1].toFixed(3)-altura[0].toFixed(3))/(t.length-1-0),(d-altura[0].toFixed(3))/(i-0)<=n?1:0):altura[t.length-1].toFixed(3)<d<altura[0].toFixed(3)?(n=(altura[t.length-1].toFixed(3)-altura[0].toFixed(3))/(t.length-1-0))<=(d-altura[0].toFixed(3))/(i-0)?1:0:1}if(0==i||i==t.length-1){if(0==(l=altura.indexOf(data.getDistinctValues(1)[t.length-2]))||l==t.length-1){var r=data.getDistinctValues(1)[t.length-3].toFixed(1),u=altura.indexOf(data.getDistinctValues(1)[t.length-3]);return r>altura[t.length-1].toFixed(3)&&r>altura[0].toFixed(3)?0:altura[0].toFixed(3)<r<altura[t.length-1].toFixed(3)?(n=(altura[t.length-2].toFixed(3)-altura[0].toFixed(3))/(t.length-1-0),(r-altura[0].toFixed(3))/(u-0)<=n?1:0):altura[t.length-1].toFixed(3)<r<altura[0].toFixed(3)?(n=(altura[t.length-1].toFixed(3)-altura[0].toFixed(3))/(t.length-1-0))<=(r-altura[0].toFixed(3))/(u-0)?1:0:1}return 1}var s=data.getDistinctValues(1)[t.length-2].toFixed(1);return s>altura[t.length-1].toFixed(3)&&s>altura[0].toFixed(3)?0:altura[0].toFixed(3)<s<altura[t.length-1].toFixed(3)?(n=(altura[t.length-1].toFixed(3)-altura[0].toFixed(3))/(t.length-1-0),(s-altura[0].toFixed(3))/(l-0)<=n?1:0):altura[t.length-1].toFixed(1)<s<altura[0].toFixed(1)?(n=(altura[t.length-1].toFixed(1)-altura[0].toFixed(1))/(t.length-1-0))<=(s-altura[0].toFixed(1))/(l-0)?1:0:1}function MF(t,e,a,o,n){var l;return l="1"==e?4:"2"==e?1:.25,30*Math.log10(t)+10*Math.log10(6*l*a*o)-10*Math.log10(1-n)-70}function ModifyHeight(){distanciaobject=document.getElementById("distanciaobjeto").value;var t=100*dist;Math.floor(t);if(0<distanciaobject<t){flag=1,muestra_mod[++contador]=Math.floor(distanciaobject/10),console.log("muestra_mod: "+muestra_mod[contador]),displayPathElevation(camino,elevator,dist);var e=LOS(elevations,coordenadas);return console.log("¿Hay LOS2?: "),void(1==e?console.log("Si!"):0==e?console.log("No!"):console.log("Indefinido"))}alert("distancia excede el largo del camino")}function Tilt(t,e,a){return toDegrees(Math.atan((e-a)/t))}function DeshacerAltura(){if(0<=contador)return flag=3,void displayPathElevation(camino,elevator,dist);alert("Ya se deshicieron todos los cambios.")}function ClickInput(){geocodeLatLng(new google.maps.Geocoder,map)}function DistanceToBorders(t,e){lat[0]=t[e].lat(),lng[0]=t[e].lng(),lat[1]=t[255].lat(),lng[1]=t[255].lng();var a=haversine(radius,lat,lng);console.log("Distancia a RX"+a.toFixed(6)+" km"),lat[1]=t[0].lat(),lng[1]=t[0].lng();haversine(radius,lat,lng);console.log("Distancia a TX"+a.toFixed(6)+" km")}function dragElement(e){var a=0,o=0,n=0,l=0;function t(t){(t=t||window.event).preventDefault(),n=t.clientX,l=t.clientY,document.onmouseup=d,document.onmousemove=i}function i(t){(t=t||window.event).preventDefault(),a=n-t.clientX,o=l-t.clientY,n=t.clientX,l=t.clientY,e.style.top=e.offsetTop-o+"px",e.style.left=e.offsetLeft-a+"px"}function d(){document.onmouseup=null,document.onmousemove=null}document.getElementById(e.id+"Header")?document.getElementById(e.id+"Header").onmousedown=t:e.onmousedown=t}function displayPathElevation(t,e,a){var o=100*a,n=Math.floor(o);console.log("Cantidad de muestras por km: "+o),console.log("Redondeo de muestras: "+n),e.getElevationAlongPath({path:t,samples:n},plotElevation)}function plotElevation(t,e){var a=document.getElementById("elevation_chart");if("OK"===e){if(!data||2==flag){data=new google.visualization.DataTable,chart=new google.visualization.ColumnChart(a),data.addColumn("string","Sample"),data.addColumn("number","Elevation");for(var o=0;o<t.length;o++)data.addRow(["",t[o].elevation]),"undefined"==data.getValue(o,1)&&(coordenadas[o]=0,altura[o]=0),altura[o]=data.getValue(o,1),coordenadas[o]=t[o].location;flag=0}if(0==flag){mitad_cantmuestras=t.length/2,console.log("Altura de cada punto: "+altura[0]+", "+altura[1]+", "+altura[2]),console.log("Coordenadas de cada punto: ("+coordenadas[0].lat()+", "+coordenadas[0].lng()+") ("+coordenadas[1].lat()+", "+coordenadas[1].lng()+")"),console.log("Altura Pmax: "+data.getDistinctValues(1)[t.length-1]);var n=altura.indexOf(data.getDistinctValues(1)[t.length-1]);console.log("Posición de Pmax: "+n);haversine(radius,latitud,longitud)}else if(1==flag){var l=parseFloat(altura[muestra_mod[contador]])+parseFloat(document.getElementById("alturaobjeto").value),i=document.getElementById("distanciaobjeto").value;muestra_mod[contador]=Math.floor(i/10),data.setValue(muestra_mod[contador],1,l),console.log("Muestra moddh: "+muestra_mod[contador]),console.log("alturaobjetodh: "+document.getElementById("alturaobjeto").value),console.log("valuetomodifydh: "+l),document.getElementById("alturaobjeto").value="",document.getElementById("distanciaobjeto").value="",flag=0}else 3==flag&&(data.setValue(muestra_mod[contador],1,altura[muestra_mod[contador]]),flag=0,contador--);chart.draw(data,{height:200,legend:"none",titleX:"Cantidad de muestras",titleY:"Elevation (m)"});var d=LOS(t,coordenadas);console.log("¿Hay LOS?: "),1==d?console.log("Si!"):0==d?console.log("No!"):console.log("Indefinido")}else a.innerHTML="Cannot show elevation: request failed because "+e}function showCoordenadas(t,e){for(var a=0;a<markers.length;a++)document.getElementById("transmisor").value=t[0]+", "+e[0],document.getElementById("receptor").value=t[1]+", "+e[1];if(0!==t[0]&&0!==t[1]){var o=haversine(radius,t,e);document.getElementById("result3").innerHTML=o.toFixed(6)+" km"}}function deleteMarkersAndPath(){markers[0].setMap(null),markers[1].setMap(null),markers=[],latitud=[],longitud=[],camino=[],elevator=[],elevations=[],altura=[],contador=data=0,path=poly.setPath([]),document.getElementById("transmisor").value="",document.getElementById("receptor").value="",document.getElementById("result3").innerHTML="",document.getElementById("elevation_chart").innerHTML="",document.getElementById("elevation_chart2").innerHTML=""}dragElement(document.getElementById("Boton"));var data,chart,distanciaobject,elevator,dist,labels="AB",labelIndex=0,markers=[],latitud=[],longitud=[],radius=6371,camino=[],altura=[],coordenadas=[],mitad_cantmuestras=0,posic_puntoMax=0,valor_puntoMax=0,flag=0,muestra_mod=[],contador=0,APP={};function initMap(){var e=new google.maps.Map(document.getElementById("map"),{zoom:15,center:{lat:-34.916467,lng:-56.154272}});google.maps.event.addListener(e,"click",function(t){markers.length<=1&&addMarkersAndAll(t.latLng,e)}),poly=new google.maps.Polyline({strokeColor:"#000000",strokeOpacity:1,strokeWeight:3})}function geocodeLatLng(t,a){console.log("test2");var e=document.getElementById("transmisor").value.split(",",2),o={lat:parseFloat(e[0]),lng:parseFloat(e[1])};t.geocode({location:o},function(t,e){if("OK"===e)if(t[0]){new google.maps.Marker({position:o,map:a});addMarkersAndAll(location,a)}else window.alert("No results found");else window.alert("Geocoder failed due to: "+e)})}function haversine(t,e,a){var o=ToRadians(e[0]),n=ToRadians(a[0]),l=ToRadians(e[1]),i=o-l,d=n-ToRadians(a[1]),r=Math.sin(i/2),u=Math.sin(d/2),s=Math.pow(r,2)+Math.cos(o)*Math.cos(l)*Math.pow(u,2);return 2*t*Math.asin(Math.min(1,Math.sqrt(s)))}function toggleBounce(){marker.setAnimation(google.maps.Animation.BOUNCE)}function printPDF(){var t=new jsPDF;t.fromHTML($("#panel-total").get(0),20,20,{width:500}),t.save("Reporte.pdf")}function toDegrees(t){return 180*t/Math.PI}function ToRadians(t){return t*(Math.PI/180)}google.load("visualization","1",{packages:["columnchart"]});